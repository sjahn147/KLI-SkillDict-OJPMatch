# 1.단어 추출 및 분류

## 1.1 추출 준비

### 1.1.1. 구인공고 샘플링

  - 전체 10,000,000 건 중 200,000 건 랜덤 샘플링
  - 온라인 구인 공고로부터 수집된 업종 정보를 처리해 구인공고의 업종별 분포 확인

![image](https://github.com/user-attachments/assets/e01e8e63-9728-4880-b2a5-e37e3046b84a)

### 1.1.2. 구인공고 전처리

![image](https://github.com/user-attachments/assets/6bc74e9e-77b2-4596-ab8e-2d0d23bcddd7)

  - 숙련과 무관한 내용을 미리 제거함.
  - 토큰 수 감소와 추출 품질 개선을 위해 필수적. 잘못된 추출을 방지하므로 추출 뒤 전처리의 수고를 크게 덜 수 있음.
  - 구인공고는 '직무 관련' 내용이 나오고 '근무 조건', '복리 후생', '전형 절차' 내용이 나오는 구조화된 텍스트이므로 이러한 전처리가 가능함.

#### 절사 코드
```python
def preprocess_job_desc(text):
    if pd.isna(text):
        return ""
    if not isinstance(text, str):
        text = str(text)
    # 불필요한 문구 제거
    patterns_to_remove = [
        r"기업\s*소개\s*또는\s*채용\s*안내를\s*작성해\s*보세요\s*불필요시\s*'?소개글'?을\s*OFF하면\s*소개\s*영역이\s*숨겨집니다\.?",
        r"\*{3}\s*입사\s*지원",
        r"\*{3}\s*온라인\s*이력서",
        r"유의\s*사항\s*[ㆍ·]\s*학력[,\s]*성별[,\s]*연령을\s*보지\s*않는\s*블라인드\s*채용입니다\.?",
        r"입사\s*지원\s*서류에\s*허위\s*사실이\s*발견될\s*경우[,\s]*채용\s*확정\s*이후라도\s*채용이\s*취소될\s*수\s*있습니다\.?",
        r"모집\s*분야별로\s*마감일이\s*상이할\s*수\s*있으니\s*유의하시길\s*바랍니다\.?",
        r"상세\s*사항\s*전화\s*문의\s*요망",
        r"접수된\s*지원서는\s*최초\s*접수일로부터\s*1년간\s*보관되며\s*1년이\s*경과된\s*뒤에는\s*자동\s*파기",
        r"급여\s*및\s*복리후생은\s*당사\s*규정에\s*준하여\s*적용",
        r"3개월\s*근무\s*평가\s*후\s*정규직\s*전환\s*면접\s*실시",
        r"이력서\s*등\s*제출\s*서류에\s*허위\s*사실이\s*있을\s*시\s*채용\s*취소",
        r"자세한\s*상세\s*요강은\s*반드시\s*채용\s*홈페이지에서\s*직접\s*확인해\s*주시기\s*바랍니다"
    ]
    for pattern in patterns_to_remove:
        text = re.sub(pattern, "", text, flags=re.IGNORECASE)
    # 절사 기준이 되는 문구 인식
    base_keywords = [
        r'혜택\s*및\s*복지',
        r'근무\s*조건',
        r'전형\s*절차',
        r'접수\s*기간',
        r'지원\s*방법',
        r'지원\s*자격',
        r'채용\s*절차',
        r'제출\s*서류',
        r'기타\s*사항',
        r'복지\s*제도',
        r'급여\s*및',
        r'근무\s*형태',
        r'근무\s*환경',
        r'복리\s*후생',
        r'서류\s*전형',
        r'접수된\s*지원서',
    ]
    cut_keywords = '|'.join(base_keywords)
    pattern = fr'(^|\s|\S)({cut_keywords})'
    match = re.search(pattern, text, re.IGNORECASE)
    if match:
        text = text[:match.start() + 1] # +1 to include the character before the keyword
    # 불필요한 공백 제거
    text = re.sub(r'\s+', ' ', text).strip()
    return text
```

## 1.2. 단어 추출
### 1.2.1. 프롬프트 엔지니어링
  - 추출 방법 : OpenAI API를 활용해 온라인 공고에서 숙련 용어를 추출.
    - GPT 4-o mini
  - 결과물 형식 : 숙련 용어를 구분자 파이프(|)로 구분하여 추출하도록 지시
  - 파라미터 조정 : 응답의 creativity 파라미터인 temperature를 낮추고, 임의 응답을 줄이기 위해 max token 수도 적절하게 제한
#### 프롬프트 구조
**user prompt : 주로 개별 결과물에 직접적인 영향**
• 작업 개요 : “구인공고로부터 숙련을 추출하고 있습니다.” 
• {구인공고 텍스트}
• 결과물 형식 지정 : “불필요한 응답 없이 단어만 제공하세요.“, “구분자 파이프 (|) 로 구분하여 제공하세요.”

**role prompt : 주로 전체 작업 결과의 일관성에 영향**
• 역할 부여 : “당신은 숙련을 추출하는 전문가입니다.”
• 작업 예시 : “MS Office|성실함|Java|” 
• 작업 시 주의사항 : “복리후생 등 무관한 단어를 추출하지 마세요.”, “구인공고에서 확인할 수 있는 단어만 추출하세요.”
### 1.2.2. 추출 안정성 개선
  - 작은 크기로 나누어 추출
  - 중간 결과물을 저장하게 하고, 예기치 못한 중단 시 중단 지점에서 쉽게 재개할 수 있게 함.
  - 안정적인 로컬 환경에서 복수 개의 세션으로 진행

## 1.3. 단어 분류

### 1.3.1. LLM 초벌 분류
![Pasted image 20241029231223](https://github.com/user-attachments/assets/5c088093-9549-441e-b36c-67af5d8637bd)

- **대분류 및 하위 분류** : 단어 수준 클러스터링 진행하기 전에 사전 분류 진행
	- 33,000개를 전체 클러스터링하는 방식으로는 숙련 식별 불가. 일정 범주 내에서 비슷한 단어를 묶어야함. 
	- LightCast 범주표를 사전 지식으로 제공함. 범주 코딩을 완전히 Bottom-up 방식으로 하면 LLM 응답에 일관성이 없게 되어 전처리 부담 증가
- **isSoftskill? (Y, N) 코딩**
	- 소프트스킬 분리를 위해 매우 복잡한 텍스트 분석 기법 사용해야함.
	- 초벌 분류 코딩 단계에서 소프트 숙련 분류도 함께 진행
- **isSkill? 코딩** : 클러스터링 품질에 영향을 주는 비숙련 단어 분리
	- 숙련 : 25,230 건
	- 근무 조건 : 2,644 건
	- 자격증 : 1,707 건
	- 학력 사항 : 1,948 건
	- 식별 불가 : 16,695 건

#### LLM 초벌 분류 프롬프트

##### Lightcast Skill Taxonomy

| 카테고리         | 하위 카테고리          |
| ------------ | ---------------- |
| 관리           | 관리 지원            |
| 관리           | 받아쓰기             |
| 관리           | 문서 관리            |
| 관리           | 일반 관리 및 사무 업무    |
| 관리           | 오피스 및 생산성 소프트웨어  |
| 관리           | 사무실 관리           |
| 관리           | 스케줄링             |
| 농업, 원예 및 조경업 | 농업 관리 및 운영       |
| 농업, 원예 및 조경업 | 농업 연구 및 농학       |
| 농업, 원예 및 조경업 | 양식업              |
| 농업, 원예 및 조경업 | 대마초              |
| 농업, 원예 및 조경업 | 농작물 재배           |
| 농업, 원예 및 조경업 | 조경 및 정원 관리       |
| 농업, 원예 및 조경업 | 축산               |
| 분석           | 비즈니스 인텔리전스       |
| 분석           | 비즈니스 인텔리전스 소프트웨어 |
| 분석           | 데이터 분석           |
| 분석           | 데이터 과학           |
| 분석           | 데이터 시각화          |
| 분석           | 이미지 분석           |
| 분석           | 수학 소프트웨어         |
| 분석           | 수학 및 수학적 모델링     |
| 분석           | 자연어 처리(NLP)      |
| 분석           | 통계 소프트웨어         |
| 분석           | 통계학              |
##### system prompt
```
제공한 숙련분류체계를 활용해서, 지금부터 제가 드릴 skill term 목록을 다음 레이아웃으로 정리해주세요. 

category| subcategory| skill| keyword|skill_yn|softskill

category : 숙련의 대분류입니다. 
subcategory : 숙련의 하위분류입니다. 
skill : 숙련의 이름입니다. 
keyword : skill 열을 조금 더 일관성있고 정돈된 단어로 정리한 것입니다. 영어로 되어있는 경우 한국어로 번역하면 좋습니다. 
skill_yn : 숙련의 여부를 결정합니다. 1) 1 - 숙련 2- 숙련 아님 3- 자격증 4- 학력 5- 식별 불가  [참고. skill_yn 열의 2-비숙련으로 코딩할 수 있는 것은 복리후생이나 근무지, 근무조건, 급여, 경력 기간 등의 숙련과 무관한 내용을 말합니다. 사원급, 대리급, 부장급 등의 직책 관련 내용도 skill_yn의 2 - 비숙련으로 코딩하면 됩니다.  단어의 뜻이 너무 일반적이거나 불명확한 경우 5 - 식별 불가로 분류해주세요.skill term이 조금이라도 깨져있거나 글자수가 한글자에 불과하거나 -은-는-이-가 등의 조사로 되어있으면 모두 5로 코딩하세요.]
softskill : 소프트숙련 여부를 결정합니다. 소프트숙련은 "끈기", "열정" 등과 같이 개인의 내적인 품성이나 역량을 말합니다. 반대되는 표현인 하드 숙련은 "Adobe Photoshop" "회계 프로그램 사용" 과 같은 숙련을 말합니다. 1- 소프트 숙련 2- 하드 숙련


유의사항
1. "능력자", "가능자" ,"가능", "사용", "능숙자", "능통자" " 유" 등의 단어는 의미가 없지만 단어 통합에 방해가 되는 단어입니다. keyword 열에는 가능한 이런 단어를 포함시키지 말아주세요. 
2. 처음에 제공한 숙련분류체계를 준수하여 코딩해주세요. 
3. '문의' '질문'처럼 비슷한 의미의 단어가 있으면 일관성을 위해 keyword 열에 가능한 하나의 단어로 압축해서 써주세요. "1 : 1 문의 응대" "1 : 1 질문 " -> "1 : 1 문의 응대"

구분자 파이프 (|)를 사용하는 csv 형태로 코딩하세요. 순서대로 누락없이 모두 작업해야합니다. 제공된 목록이 끝나 더 이상 작업할 것이 없으면 임의로 생성하지 않고 작업을 중단하면 됩니다. 작업이 완료되면 "작업 완료"라고 응답하세요. 

다음은 작업을 잘한 사례입니다. 

category| subcategory| skill| keyword|skill_yn|softskill
자산 및 부동산|부동산 관리|빌딩 시설 관리|빌딩 시설 관리|1|2
자산 및 부동산|부동산 관리|빌딩관리|빌딩 관리|1|2
자산 및 부동산|부동산 관리|빌딩매니저|빌딩 매니저|1|2
자산 및 부동산|부동산 관리|빌딩자동제어 운영|빌딩 자동제어 운영|1|2
자산 및 부동산|부동산 판매|빌라|빌라|1|2
신체적 능력 및 내적 능력|개인 속성|빠른 실행력|빠른 실행력|1|1
신체적 능력 및 내적 능력|커뮤니케이션|빠른 의사 소통|빠른 의사소통 능력|1|1
NULL|NULL|빠른 입사|빠른 입사|2|2
NULL|NULL|빠른 입사|빠른 입사|2|2
신체적 능력 및 내적 능력|개인 속성|빠른 적응력|빠른 적응력|1|1
신체적 능력 및 내적 능력|개인 속성|빠른 학습능력|빠른 학습 능력|1|1
NULL|NULL|빠른면접지원|빠른 면접 지원|5|2
신체적 능력 및 내적 능력|개인 속성|빠른판단능력|빠른 판단 능력|1|1
신체적 능력 및 내적 능력|개인 속성|빠른판단력|빠른 판단력|1|1
NULL|NULL|빨리|빨리|5|2
접객 및 식품 서비스|식음료|빵|빵|1|2
접객 및 식품 서비스|식음료|빵 제조|빵 제조|1|2
접객 및 식품 서비스|식음료|빵류|빵류|1|2
접객 및 식품 서비스|식음료|빵류 제조|빵류 제조|1|2
접객 및 식품 서비스|식음료|빵류 제조|빵류 제조|1|2
접객 및 식품 서비스|식음료|빵집|빵집|1|2
NULL|NULL|뿐만|뿐만|5|2
헬스 케어|부상 치료|쁘띠|쁘띠 시술|1|2
헬스 케어|부상 치료|쁘띠 시술 어시스트|쁘띠 시술 보조|1|2
NULL|NULL|사 후|사후|5|2
교육 및 훈련|교육|사감|사감|1|2
법, 규제 및 컴플라이언스|법률 지원|사건 관리|사건 관리|1|2
NULL|NULL|사고|사고|5|2
고객 및 클라이언트 지원|고객 서비스|사고 접수|사고 접수|1|2
운송, 공급망 및 물류|운송 운영|사고대차|사고 대차|1|2
신체적 능력 및 내적 능력|문제 해결 능력|사고력|사고력|1|1
교육 및 훈련|교육|사고력 수학|사고력 수학|1|2
교육 및 훈련|교육|사고력수학|사고력 수학|1|2
고객 및 클라이언트 지원|고객 서비스|사고접수|사고 접수|1|2
NULL|NULL|사근동|사근동|5|2
IT 정보 기술|데이터베이스|사내 DATABASE 그룹웨어 관리|사내 데이터베이스 및 그룹웨어 관리|1|2
IT 정보 기술|소프트웨어 개발|사내 ERP 시스템|사내 ERP 시스템|1|2
NULL|NULL|사내 건강검진|사내 건강검진|2|2
IT 정보 기술|소프트웨어 개발|사내 그룹웨어 / ERP 관리|사내 그룹웨어 및 ERP 관리|1|2
인적 자원 관리|직원 교육|사내 기초교육 관리 수행|사내 기초교육 관리 및 수행|1|2
IT 정보 기술|네트워크 하드웨어|사내 네트워크 설계|사내 네트워크 설계|1|2
NULL|NULL|사내 동아리 활동|사내 동아리 활동|2|2
NULL|NULL|사내 동호회 운영|사내 동호회 운영|2|2
NULL|NULL|사내 동호회 활동|사내 동호회 활동|2|2
NULL|NULL|사내 동호회 활동 지원|사내 동호회 활동 지원|2|2
법, 규제 및 컴플라이언스|법률 지원|사내 법률 이슈 리스크 검토 지원|사내 법률 이슈 및 리스크 검토 지원|1|2
NULL|NULL|사내 벤처|사내 벤처|5|2
법, 규제 및 컴플라이언스|법률 지원|사내 변호사|사내 변호사|1|2
IT 정보 기술|네트워크 하드웨어|사내 서버 방화벽 운영|사내 서버 및 방화벽 운영|1|2
```
